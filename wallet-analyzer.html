<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>PLU Wallet Analyzer</title>
</head>
<body>
    <div class="container">
        <button id="themeToggle" title="Toggle Dark Mode">🌙</button> <!-- Moved here -->
        <h1>PLU Wallet Analyzer</h1>
        <input type="text" id="walletAddress" placeholder="Enter Wallet Address">
        <button id="checkButton">Check Wallet</button>
        
        <div id="results" class="results"></div>
        
        <div id="exclusions" class="exclusions">
            <h2>Exclusions</h2>
            <p>Total $PLU Redeemed: <span id="redeemedTotal">0</span></p>
        </div>
    </div>

    <script>
        const excludedWallets = [
            "0xE18F094DDd37f0eB2b651b65C4Aad080aFe90e51"
        ];

        // Check for saved theme preference on load
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.body.classList.toggle('dark-mode', savedTheme === 'dark');
        }

        // Toggle dark mode on button click
        const themeToggle = document.getElementById('themeToggle');
        themeToggle.onclick = () => {
            document.body.classList.toggle('dark-mode');
            const newTheme = document.body.classList.contains('dark-mode') ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme); // Save user preference
            
            // Change icon based on theme
            themeToggle.innerText = document.body.classList.contains('dark-mode') ? '☀️' : '🌙'; // Sun for dark mode, moon for light mode
        };

        // Set initial icon based on saved theme
        themeToggle.innerText = document.body.classList.contains('dark-mode') ? '☀️' : '🌙';

        // Wallet checker functionality
        document.getElementById('checkButton').onclick = async () => {
            const walletAddress = document.getElementById('walletAddress').value;
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            const redeemedTotal = document.getElementById('redeemedTotal');

            try {
                // Fetch PLU transaction data from Etherscan (using your API key)
                const response = await fetch(`https://api.etherscan.io/api?module=account&action=tokentx&contractaddress=0xD8912C10681D8B21Fd3742244f44658dBA12264E&address=${walletAddress}&apikey=USS41WYMMAIRJZ2EH8BDRV8G395CEU4GPH`);
                const data = await response.json();

                let totalPLU = 0;
                let redeemedPLU = 0;
                let outgoingPLU = 0;

                if (data.result.length > 0) {
                    data.result.forEach(tx => {
                        const value = parseFloat(tx.value) / 1e18; // Convert from wei to PLU
                        if (excludedWallets.includes(tx.to)) {
                            redeemedPLU += value; // Count redeemed amounts
                        } else if (tx.from === walletAddress) {
                            outgoingPLU += value; // Count outgoing amounts
                        } else {
                            totalPLU += value; // Count total incoming amounts
                        }
                    });
                }

                // Calculate remaining PLU
                const remainingPLU = totalPLU - outgoingPLU;

                // Display results
                resultsDiv.innerHTML = `
                    <p>Total PLU Incoming: ${totalPLU.toFixed(4)}</p>
                    <p>Total PLU Outgoing: ${outgoingPLU.toFixed(4)}</p>
                    <p>Remaining PLU: ${remainingPLU.toFixed(4)}</p>
                `;
                
                // Update redeemed total
                redeemedTotal.innerText = redeemedPLU.toFixed(4);

            } catch (error) {
                console.error('Error fetching transaction data:', error);
                resultsDiv.innerHTML = `<p>Error fetching data. Please try again.</p>`;
            }
        };
    </script>
</body>
</html>
